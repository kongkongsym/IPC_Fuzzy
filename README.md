# 倒立摆模糊控制系统 (IPC_Fuzzy)

基于MATLAB实现的倒立摆模糊逻辑控制仿真系统，用于演示和研究倒立摆的稳定控制问题。

## 📋 项目简介

本项目实现了一个**车-摆系统**的模糊逻辑控制器，通过对小车施加水平力来使摆杆保持直立状态。系统采用双控制器架构，分别控制小车位置和摆杆角度，最终实现系统的稳定控制。

### 核心特点
- ✅ 完整的模糊逻辑控制流程（模糊化→推理→去模糊化）
- ✅ 双控制器并行架构（位置控制器 + 角度控制器）
- ✅ 基于拉格朗日力学的物理模型
- ✅ 实时状态可视化与数据记录
- ✅ 包含PID控制对比实现

## 🚀 快速开始

### 运行要求
- MATLAB R2016b 或更高版本
- 无需额外工具箱

### 运行主程序
```matlab
% 在MATLAB中打开项目目录
cd d:\300-code\IPC_Fuzzy

% 运行模糊控制仿真
inverted_pendulum_Fuzzy
```

### 运行PID对比控制
```matlab
% 切换到子函数目录
cd sub_functions

% 运行PID控制仿真
inverted_pendulum_PID
```

## 📁 项目结构

```
IPC_Fuzzy/
│
├── inverted_pendulum_Fuzzy.m    % 主程序：模糊控制仿真
├── README.md                     % 项目说明文档（本文件）
├── CLAUDE.md                     % AI助手指导文档
│
├── figures/                      % 自动生成的图像输出目录
│   ├── Fig1_System_Snapshots.png
│   ├── Fig2_State_Response.png
│   ├── Fig3_Control_Forces.png
│   ├── Fig4_Fuzzy_Variables.png
│   └── Fig5_Phase_Space.png
│
└── sub_functions/                % 核心功能函数
    ├── fuzzification.m           % 模糊化模块
    ├── fuzzy_inference.m         % 模糊推理模块
    ├── defuzzification.m         % 去模糊化模块
    ├── diff_pendulum.m           % 物理动力学模型
    └── inverted_pendulum_PID.m   % PID控制对比程序
```

## 🎯 控制系统架构

### 1. 模糊控制流程（每个控制周期）

```
输入误差信号 → 模糊化 → 模糊推理 → 去模糊化 → 控制力输出
     ↓           ↓         ↓          ↓           ↓
  ex, dex    隶属度值   规则激活   重心法解模糊   u_x, u_q
  eq, deq    (5×2矩阵)  (规则表)   归一化输出     合成力F
```

**控制周期**: Ts = 0.01秒（100Hz）

### 2. 双控制器架构

系统采用**两个独立的模糊控制器**并行工作：

- **小车位置控制器**：生成控制力 `u_x`，目标是将小车保持在期望位置
- **摆杆角度控制器**：生成控制力 `u_q`，目标是使摆杆保持垂直向上

**最终控制力合成**：
```matlab
F = -u_x + u_q
```
（小车控制器取反向，实现协调控制）

### 3. 模糊集合与规则

**模糊语言变量**（5个模糊集）：
- **NB**: Negative Big（负大）
- **NS**: Negative Small（负小）
- **ZO**: Zero（零）
- **PS**: Positive Small（正小）
- **PB**: Positive Big（正大）

**模糊规则矩阵**（5×5）：
```
        deq:  NB   NS   ZO   PS   PB
      ┌─────────────────────────────
eq: NB│     NB   NB   NB   NS   NB
    NS│     NB   NB   NS   PB   PS
    ZO│     NB   NB   ZO   PB   PB
    PS│     PS   NB   PS   PB   PB
    PB│     PB   PS   PB   PB   PB
```

## ⚙️ 系统参数

### 物理参数
| 参数 | 符号 | 数值 | 单位 |
|------|------|------|------|
| 小车质量 | M | 2.0 | kg |
| 摆杆质量 | m | 0.8 | kg |
| 摆杆长度 | l | 0.25 | m |
| 小车阻尼系数 | bx | 0.005 | kg/s |
| 摆杆阻尼系数 | bq | 0.0005 | kg·m²/s |
| 转动惯量 | J | 0.0326 | kg·m² |
| 重力加速度 | g | 9.81 | m/s² |

### 归一化因子（映射到模糊域 [-1, 1]）
- 小车位置：12 m
- 小车速度：1.5 m/s
- 摆杆角度：360° (2π rad)
- 摆杆角速度：180° (π rad)
- 控制力：1000 N

### 控制增益
- 位置控制器增益：`gain_x = 1`
- 角度控制器增益：`gain_q = 2`

### 初始条件
```matlab
X = [cart_position; cart_velocity; pendulum_angle; angular_velocity]
X₀ = [-0.5 m; 0 m/s; 15°; 0 rad/s]
```

## 📊 输出可视化

运行程序后，所有图片将自动保存到 `figures/` 目录。

### 模糊控制输出图片（运行 `inverted_pendulum_Fuzzy.m`）

1. **Fig1_System_Snapshots.png** - 系统状态演化快照
   - 展示4个关键时刻（t=0s, 2s, 5s, 10s）的系统状态
   - 包含小车位置、摆杆角度的可视化
   - 标注当前角度信息

2. **Fig2_State_Response.png** - 状态响应曲线图
   - 子图1：小车位置和速度随时间变化
   - 子图2：摆杆角度和角速度随时间变化（含目标角度参考线）
   - 子图3：控制力分解图（总控制力F、小车控制力u_x、摆杆控制力u_q）

3. **Fig3_Performance_Analysis.png** - 控制性能分析
   - 子图1：小车位置跟踪误差
   - 子图2：摆杆角度跟踪误差
   - 子图3：性能指标统计（调节时间、最大偏差）
   - 子图4：累积控制能量消耗

4. **Fig4_Fuzzy_System.png** - 模糊控制系统可视化
   - 子图1：输入隶属函数（NB, NS, ZO, PS, PB）
   - 子图2：模糊规则表热力图
   - 子图3：输出隶属函数
   - 子图4：三维模糊控制曲面
   - 子图5：仿真过程中的模糊输入轨迹
   - 子图6：相平面轨迹（起点→终点）

### PID控制输出图片（运行 `sub_functions/inverted_pendulum_PID.m`）

1. **Fig1_PID_System_Snapshots.png** - 系统状态演化快照（PID控制）
   - 展示4个关键时刻的系统状态
   - 与模糊控制进行对比

2. **Fig2_PID_State_Response.png** - 状态响应曲线图（PID控制）
   - 小车位置、速度、摆杆角度、角速度响应
   - PID控制力输出（总控制力、小车控制力、摆杆控制力）

3. **Fig3_PID_Performance_Analysis.png** - PID控制性能分析
   - 位置和角度跟踪误差
   - 性能指标统计
   - 控制能量消耗分析

4. **Fig4_PID_Components.png** - PID组件详细分析
   - 小车PID各分量（P、I、D）时域曲线
   - 摆杆PID各分量时域曲线
   - PID分量贡献比例统计
   - 小车和摆杆相平面轨迹
   - 控制力分布直方图

### 图片用途说明

这些静态图片适合用于：
- 学术报告演示
- 论文插图
- 控制性能对比分析
- 算法调优参考

所有图片均为高分辨率PNG格式，包含清晰的中文标注和图例。

## 🔧 核心函数说明

### `fuzzification.m`
**功能**：将归一化的误差信号转换为模糊隶属度值

**输入**：
- `e`: 误差（归一化到 [-1, 1]）
- `de`: 误差变化率（归一化到 [-1, 1]）

**输出**：
- `fuzzy`: 5×2矩阵，列1为e的隶属度，列2为de的隶属度

**隶属函数**：三角形隶属函数，各集合中心点为 {-1, -0.5, 0, 0.5, 1}

### `fuzzy_inference.m`
**功能**：根据模糊规则进行推理，确定输出模糊集

**输入**：
- `fuzzy`: 5×2隶属度矩阵

**输出**：
- `u_indx`: N×2矩阵，每行为 [输出模糊集索引, 激活强度]

**规则激活**：使用最小值法（取两个输入隶属度的最小值）

### `defuzzification.m`
**功能**：将模糊推理结果转换为精确控制值

**输入**：
- `u_indx`: 模糊推理输出

**输出**：
- `u_tilde`: 归一化控制值（[-1, 1]范围）

**方法**：重心法（Center of Gravity），在100个离散点上计算

### `diff_pendulum.m`
**功能**：计算系统状态导数（物理动力学模型）

**输入**：
- `X`: 状态向量 [x; ẋ; θ; θ̇]

**输出**：
- `dX`: 状态导数 [ẋ; ẍ; θ̇; θ̈]

**方法**：基于拉格朗日力学方程推导

## 🔬 技术细节

### 数值积分
使用MATLAB内置的 `ode45` 函数（显式Runge-Kutta方法）进行状态更新：
```matlab
[T, X_next] = ode45(@diff_pendulum, [0, Ts], X);
X = X_next(end,:)';
```

### 误差计算
- 位置误差：`ex = xd - X(1)`（期望位置 - 当前位置）
- 误差变化：`dex = x_prev - X(1)`（使用差分近似导数）
- 角度误差：`eq = qd - X(3)`
- 角度变化：`deq = q_prev - X(3)`

### 数据记录
仿真过程中记录：
- 状态历史：`X_Fuzzy`（(T_final/Ts+1)×4 矩阵）
- 时间序列：`time_Fuzzy`
- 控制力历史：`F_save`
- 子控制器输出：`u_save`（[u_x, u_q]）
- 模糊输入变量：`fuzzy_data`（[ex, dex, eq, deq]）

## 📝 修改指南

### 调整控制参数
修改 `inverted_pendulum_Fuzzy.m` 中的以下行：

**归一化因子**（第28-33行）：
```matlab
x_normal = 12;              % 小车位置归一化
dx_normal = 1.5;            % 小车速度归一化
q_normal = 360*pi/180;      % 摆杆角度归一化
dq_normal = 180*pi/180;     % 角速度归一化
u_normal = 1000;            % 控制力归一化
```

**控制增益**（第36-37行）：
```matlab
gain_x = 1;     % 位置控制器增益
gain_q = 2;     % 角度控制器增益
```

**初始条件**（第21行）：
```matlab
X = [-0.5; 0; 15*pi/180; 0];  % [位置; 速度; 角度; 角速度]
```

### 修改模糊规则
编辑 `sub_functions/fuzzy_inference.m` 中的规则矩阵（第8-12行）：
```matlab
fuzzy_rule = [1 1 1 2 1; 
              1 1 2 5 4; 
              1 1 3 5 5; 
              4 1 4 5 5; 
              5 4 5 5 5];
```

### 修改隶属函数
编辑 `sub_functions/fuzzification.m` 和 `defuzzification.m` 中的分段函数定义。

### 修改物理参数
在 `inverted_pendulum_Fuzzy.m` 中修改全局变量（第9-17行）。

## 🆚 PID控制对比

项目包含 `sub_functions/inverted_pendulum_PID.m` 作为对比实现，使用传统PID控制。

### 运行PID控制
```matlab
% 进入子函数目录
cd sub_functions

% 运行PID控制仿真
inverted_pendulum_PID

% 返回项目根目录
cd ..
```

### PID控制参数
- **小车位置控制器**：Kpx=10, Kdx=5, Kix=2
- **摆杆角度控制器**：Kpq=70, Kdq=5, Kiq=5

### 初始条件对比
- **模糊控制初始条件**：X₀ = [-0.5m; 0; 15°; 0]
- **PID控制初始条件**：X₀ = [0m; 0; 20°; 0]

### 性能对比方法
1. 分别运行两个程序，生成图片到 `figures/` 目录
2. 对比关键指标：
   - 调节时间（达到稳态所需时间）
   - 超调量（最大偏离目标角度）
   - 控制能量消耗（累积控制力）
   - 鲁棒性（对初始条件的敏感度）

### 两种控制方法的特点
| 对比项 | 模糊控制 | PID控制 |
|--------|----------|---------|
| **理论基础** | 模糊逻辑、专家经验 | 经典控制理论 |
| **数学模型** | 不需要精确模型 | 依赖系统模型 |
| **参数调整** | 规则表+增益 | 三个增益参数 (Kp, Ki, Kd) |
| **非线性处理** | 天然适合非线性系统 | 在线性化点附近有效 |
| **鲁棒性** | 对参数变化鲁棒 | 依赖精确参数调优 |
| **实现复杂度** | 较复杂（模糊化+推理+去模糊化） | 简单直观 |
| **调优难度** | 需要设计规则表 | 常用Ziegler-Nichols等方法 |

可通过运行两个程序并分析生成的图片，直观对比模糊控制与PID控制的性能差异。

## 📚 理论背景

### 倒立摆问题
倒立摆是经典的非线性、不稳定控制问题，广泛应用于：
- 控制理论教学与研究
- 机器人平衡控制
- 火箭垂直着陆控制
- 双足机器人步态规划

### 模糊逻辑控制
模糊逻辑控制（Fuzzy Logic Control, FLC）的优势：
- 无需精确数学模型
- 能够处理非线性系统
- 基于专家经验的语言规则
- 对参数变化具有鲁棒性

## 📖 参考文献

- Hyosung Hong (2017). "Inverted Pendulum Fuzzy Control Implementation"
- 倒立摆拉格朗日力学建模
- 模糊逻辑控制理论

## 👨‍💻 作者信息

- 原始作者：Hyosung Hong
- 修改日期：2025-11-10
- 用于：学术报告与控制系统研究

## 📄 许可证

本项目仅供学习和研究使用。

## 🙏 致谢

感谢MATLAB社区提供的优秀工具和文档支持。

---

**最后更新**: 2025年11月10日
